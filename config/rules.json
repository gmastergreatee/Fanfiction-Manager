[
  {
    "guid": "bf04cf84-1bfc-4233-9fa7-19871eaca783",
    "rule_name": "Fanfiction.net",
    "url_regex": "(?:https://)*(?:www|m).fanfiction.net/([a-z]+)/([0-9]+)/([0-9]+)/([a-zA-Z0-9-]+)",
    "pagetype_code": "if (document.querySelector('#cf-wrapper #cookie-alert'))\n    return -2;\nif (document.querySelector('.cf-browser-verification.cf-im-under-attack'))\n    return -1;\nif (document.querySelector('#chap_select'))\n    return 0;",
    "toc_code": "let retMe = {\n  'CoverURL': '',\n  'Title': 'novel name here',\n  'Summary': '',\n  'ChapterCount': 1,\n  'ChapterURLs': [],\n};\n\nlet chaps = [];\nArray.from($('#chap_select').first().find('option')).forEach(el=>{\n    chaps.push(el.value);\n});\n\nlet matches = new RegExp('(?:https://)*(?:www|m).fanfiction.net/([a-z]+)/([0-9]+)/([0-9]+)/([a-zA-Z0-9-]+)').exec(window.location.href);\nchaps.forEach(el => {\n    retMe.ChapterURLs.push([window.location.origin, matches[1], matches[2], el, matches[4]].join('/'));\n});\n\nretMe.ChapterCount = chaps.length;\nretMe.Title = $('#profile_top b').html();\nretMe.Summary = $('#profile_top div.xcontrast_txt').html();\nlet cover_url = $('#profile_top .cimage')[0].src;\nif (cover_url) {\n    retMe.CoverURL = cover_url.substr(0, cover_url.length - 3) + '180/';\n}\n\nreturn retMe;",
    "chapter_code": "let retMe = [\n  {\n    \"title\": \"\",    // title of chapter\n    \"content\": $('.storytext').html(),  // content\n    \"nextURL\": \"\"\n  },\n];\n\nlet chap_select = document.getElementById('chap_select');\nif (chap_select != null) {\n    retMe[0].title = chap_select.options[chap_select.selectedIndex].text;\n}\n\nreturn retMe;"
  },
  {
    "guid": "4795a493-2a6e-4234-8dec-307b06129cd6",
    "rule_name": "WebNovel.com",
    "url_regex": "(?:https://)*(?:www|m)\\.webnovel\\.com/([a-z]+)/([0-9a-z\\-A-Z]+)_([0-9]+)",
    "pagetype_code": "// chapter page 2\ntry {\n    let jsonObj = JSON.parse(document.body.innerText);\n    if (jsonObj.data.chapterInfo.chapterName)\n        return 0;\n} catch { }\n\n// toc page\nlet toc = $('a[title=\"Table of Contents\"]');\nif (toc && toc.length == 1) {\n    $('a[title=\"Table of Contents\"]')[0].click();\n    return 0;\n}\n\n// chapter page 1\nlet chapter = $('.cha-tit');\nif (chapter && chapter.length == 1) {\n    return 0;\n}",
    "toc_code": "// throw error if TOCScript script run on chapter page\nlet chapter = $('.cha-tit');\nif (chapter && chapter.length == 1) {\n    return null;\n}\n\nlet retMe = {\n  'CoverURL': $('.det-info img')[1].src,\n  'Title': $('.det-info h1')[0].innerText.trim(),\n  'Summary': $('.det-tab-pane p')[0].innerHTML.trim(),\n  'ChapterCount': parseInt($('.det-hd h2 strong span')[0].innerText),\n  'ChapterURLs': [],\n};\n\nlet waitSeconds = 0;\n\nwhile ($('#contents .g_loading').length)\n{\n    await sleep(1000);\n    waitSeconds += 1;\n    if (waitSeconds >= 10)\n        return null;\n}\n\nretMe.ChapterURLs = Array.from($('#contents a')).slice(1).map(el => el.href);\n\nreturn retMe;",
    "chapter_code": "let retMe = [\n  {\n    \"title\": \"\",    // title of chapter\n    \"content\": \"\",  // content\n    \"nextURL\": \"\"   // when \"ChapterCount\" <= 0 & \"nextURL\" always comes non-empty\n                    // will loop infinitely unless something else(javascript) breaks\n  },\n];\n\ntry {\n    let jsonObj = JSON.parse(document.body.innerText);\n    retMe[0].content = '<p>' + jsonObj.data.chapterInfo.contents.map(i=>i.content.replace('\\r\\n', '')).join('</p><p>') + '</p>';\n    retMe[0].title = jsonObj.data.chapterInfo.chapterName;\n    retMe[0].nextURL = window.location.href.split('&').map((el,i)=> i == 3 ? 'chapterId=' + jsonObj.data.chapterInfo.nextChapterId : el).join('&');\n    return retMe;\n} catch { }\n\nretMe[0].title = $('#page .cha-tit h1').html();\nretMe[0].content = \"<p>\" + Array.from($(\".cha-words p\")).map((i) => i.innerHTML.trim()).join(\"</p><p>\") + \"</p>\";\n\nlet matches = new RegExp(/.*\\/(\\d+)\\/(\\d+)/).exec($('link[rel=next]')[0].href);\nlet bookId = matches[1];\nlet nextChapterId = matches[2];\nlet _csrfToken = (await cookieStore.get('_csrfToken')).value;\nlet _fsae = (await cookieStore.get('_fsae')).value;\n\nretMe[0].nextURL = 'https://www.webnovel.com/go/pcm/chapter/getContent?' +\n    '_csrfToken=' + _csrfToken +\n    '&_fsae=' + _fsae +\n    '&bookId=' + bookId +\n    '&chapterId=' + nextChapterId +\n    '&encryptType=3&_=' + _fsae;\n\nreturn retMe;"
  }
]